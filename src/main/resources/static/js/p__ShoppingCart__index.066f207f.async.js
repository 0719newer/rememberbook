(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{OiVE:function(e,t,n){"use strict";n.r(t);n("cMPq");var o,a,i,r=n("CEb8"),l=(n("KIUd"),n("RBuq")),c=(n("5O5B"),n("oSpu")),s=(n("UV/7"),n("EKzH")),d=(n("lIhT"),n("pDnP")),u=(n("79+M"),n("L3aD")),g=(n("6hcU"),n("xDfo")),p=(n("XNN1"),n("AsLl")),h=(n("GnxM"),n("kzV1")),f=n("Pjwa"),b=n.n(f),k=n("2cji"),m=n.n(k),v=n("sp3j"),y=n.n(v),E=n("vZkh"),B=n.n(E),C=n("+KCP"),S=n.n(C),I=(n("Vu8O"),n("Uw+y")),_=n("uqIC"),x=n.n(_),w=n("LneV"),L=n("VrcO"),z=n.n(L),O=n("smUt"),j=n.n(O),T=function(e){function t(e){var n;return b()(this,t),n=y()(this,B()(t).call(this,e)),n.onSelectHandler=function(e){n.setState({bindingId:parseInt(e.value,10),selectItem:e})},n.onCancelHandler=function(){n.onCancel&&n.onCancel()},n.onSureHandler=function(){var e=n.state.selectItem;n.onSure&&n.onSure(e)},n.onCancel=e.onCancel,n.onSure=e.onSure,n.state={list:e.list||[],bindingId:e.bindingId||-1,top:e.top||0,left:e.left||0,visible:e.visible||!1,selectItem:null},n}return S()(t,e),m()(t,[{key:"componentWillReceiveProps",value:function(e){this.setState(j()({},e))}},{key:"render",value:function(){var e=this,t=this.state,n=t.list,o=t.bindingId,a=t.top,i=t.left,l=t.visible;return!1===l?"":x.a.createElement("div",{style:{position:"fixed",top:a,left:i,backgroundColor:"#ffffff",boxShadow:"0 0 5px #ccc",zIndex:1,padding:20}},x.a.createElement("div",{style:{width:200,marginBottom:20,fontWeight:"bold"}},"\u66f4\u6362\u88c5\u5e27\u65b9\u5f0f"),x.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",width:300,fontSize:12}},n.map(function(t,n){var a=o===parseInt(t.value,10)?"1px solid red":"";return x.a.createElement("div",{key:n.toString(),onClick:function(){e.onSelectHandler(t)}},x.a.createElement("img",{alt:t.name,src:t.image,style:{width:140,border:a,boxSizing:"border-box",cursor:"pointer"}}),x.a.createElement("div",{style:{marginTop:10}},t.name))})),x.a.createElement(r["a"],{style:{marginTop:10,marginBottom:10}}),x.a.createElement("div",{style:{display:"flex",justifyContent:"space-around",fontSize:12}},x.a.createElement(u["a"],{style:{padding:"0 25px",height:25,fontSize:12},onClick:this.onCancelHandler},"\u53d6\u6d88\u66f4\u6539"),x.a.createElement(u["a"],{type:"primary",style:{padding:"0 25px",height:25,fontSize:12},onClick:this.onSureHandler},"\u786e\u8ba4\u66f4\u6539")))}}]),t}(_["PureComponent"]),P=T,A=n("+n12");I["a"].config({top:100,duration:1,maxCount:3});var D=(o=Object(w["connect"])(function(e){var t=e.cart;return{cart:t}}),o((i=function(e){function t(e){var n;return b()(this,t),n=y()(this,B()(t).call(this,e)),n.updateData=function(e){var t=n.state.storageBooks,o=e.bookAttrData,a=e.bindAttrData;o.forEach(function(e){var n=e.book_id,o=e.binding_id;t[n].book.checked=!0,t[n].book.binding_id=o,t[n].book.count=1,t[n].book.size_desc=e.size_desc,t[n].book.size_id=e.size_id,t[n].book.printing_desc=e.printing_desc}),a.forEach(function(e){var n=e.book_id,o=e.attr,a=o.intro,i=o.list;t[n].book.defaultBindingName=i[0].name,t[n].book.price=parseFloat(i[0].price),t[n].book.bindingInfo={intro:a,list:i}}),n.resetStorageBooks(t),n.setState({loading:!1,hasMore:!1})},n.resetStorageBooks=function(e){var t=Object.assign({},e),o=n.calTotalPrice(t);n.setState({storageBooks:t,totalPrice:o})},n.onRemoveBook=function(e){var t=n.state.storageBooks;t[e]&&delete t[e],n.resetStorageBooks(t)},n.onOperateBookCount=function(e,t){var o=n.state.storageBooks;if(o[e]){var a=o[e].book.count;o[e].book.count=Math.max(1,a+t)}n.resetStorageBooks(o)},n.calTotalPrice=function(e){var t=0,n=Object.keys(e);return n.forEach(function(n){var o=e[n].book,a=o.count,i=o.price,r=o.checked;!0===r&&(t+=a*(1e3*i))}),t/1e3},n.showBindingList=function(e,t,o,a){var i=document.documentElement.scrollTop||document.body.scrollTop,r=n.state.enableChangeBinding;!0!==r&&1!==o.length&&n.setState({currentEditBookId:t,enableChangeBinding:!0,currentBookBindList:o,currentBookBindingId:a,bindingListTop:Object(A["c"])(e.currentTarget)+e.currentTarget.offsetHeight-i,bindingListLeft:Object(A["b"])(e.currentTarget)})},n.onChangeCount=function(e,t){var o=n.state.storageBooks,a=e.target.value;""!==a&&"-"!==a||(a=1);var i=/^-?([1-9][1-9]*)(\.[1-9]*)?$/;if(!Number.isNaN(a)&&i.test(a)){var r=Object.keys(o);r.forEach(function(e){t===parseInt(e,10)&&(o[e].book.count=parseInt(a,10),n.resetStorageBooks(o))})}},n.renderItem=function(e){var t=n.state.enableChangeBinding,o=e.book_id,a=e.title,i=e.thumbnail,r=e.page_total_count,l=e.price,c=e.checked,s=e.size_desc,f=e.count,b=e.bindingInfo,k=e.defaultBindingName,m=e.binding_id,v=f||1,y=l||0,E=b&&b.intro||"",B=b&&b.list;return x.a.createElement("div",{key:o,style:{display:"flex",justifyContent:"space-between",alignItems:"center",height:200,letterSpacing:1}},x.a.createElement("div",{style:{display:"flex",justifyContent:"flex-start",flexDirection:"row",alignItems:"center",width:200}},x.a.createElement(h["a"],{checked:c,onChange:function(e){n.onCheckChangeItem(e,o)},disabled:t}),x.a.createElement("div",{style:{width:100,marginLeft:50}},x.a.createElement("img",{alt:"\u5c01\u9762",src:i,style:{width:100,height:"auto",boxShadow:"0px 0px 3px #ccc"}})),x.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",flexDirection:"column",height:150,marginLeft:30,padding:"10px 0"}},x.a.createElement(p["a"],{title:a,placement:"leftTop"},x.a.createElement("span",{style:{color:"#000000",fontWeight:"bold",width:150,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipse"}},a)),x.a.createElement("div",{style:{fontSize:12,color:"#666666"}},x.a.createElement("div",null,"\u9875\u6570: ",r,"\u9875"),x.a.createElement("div",{style:{marginTop:10}},"\u5c3a\u5bf8: ",s)))),x.a.createElement("div",{style:{position:"relative",height:30,width:200,marginLeft:100,backgroundColor:"#F9F9F9",fontSize:14,lineHeight:30/14,padding:"0 10px",borderRadius:5,overflowX:"auto",cursor:"pointer"},onClick:function(e){return n.showBindingList(e,o,B,m)}},x.a.createElement("span",{style:{pointerEvents:"none"}},E||"",":"),x.a.createElement("span",{style:{pointerEvents:"none"}},k||""),B&&B.length>1?x.a.createElement("span",{style:{pointerEvents:"none"}},x.a.createElement(g["a"],{type:"down"})):""),x.a.createElement("div",{style:{width:100}},"\xa5 ",(1e3*y*v/1e3).toFixed(2)),x.a.createElement("div",{style:{display:"flex"}},x.a.createElement(u["a"],{type:"default",onClick:function(){n.onOperateBookCount(o,-1)},style:{width:30,height:30,padding:0,borderRadius:2,border:"1px solid #979797",textAlign:"center",lineHeight:1,fontSize:20,cursor:"pointer"},disabled:t},"-"),x.a.createElement(d["a"],{style:{width:60,height:30,borderTop:"1px solid #979797",borderBottom:"1px solid #979797",borderRadius:0,textAlign:"center",lineHeight:30/14,fontSize:14},value:f,onChange:function(e){return n.onChangeCount(e,o)}}),x.a.createElement(u["a"],{onClick:function(){n.onOperateBookCount(o,1)},style:{width:30,height:30,padding:0,borderRadius:2,border:"1px solid #979797",textAlign:"center",lineHeight:1,fontSize:20,cursor:"pointer"},disabled:t},"+")),x.a.createElement("div",{style:{color:"#000000",fontSize:12,cursor:"pointer",display:"none"},onClick:function(){return n.onRemoveBook(o)}},"\u5220\u9664"))},n.handleInfiniteOnLoad=function(){},n.onCheckChangeAll=function(e){var t=n.state.storageBooks,o=Object.keys(t);o.forEach(function(n){t[n].book.checked=e.target.checked});var a=!1===e.target.checked?0:o.length;n.resetStorageBooks(t),n.setState({selectItemCount:a})},n.onCheckChangeItem=function(e,t){var o=n.state,a=o.storageBooks,i=o.selectItemCount,r=i;a[t]&&(a[t].book.checked=e.target.checked,!0===e.target.checked?r+=1:r-=1,n.resetStorageBooks(a),n.setState({selectItemCount:r}))},n.renderBookList=function(){var e=n.state,t=e.storageBooks,o=e.loading,a=e.hasMore;if(!t)return"";var i=[];return Object.keys(t).forEach(function(e){var n=t[e].book;n&&i.push(n)}),x.a.createElement(z.a,{initialLoad:!1,pageStart:0,loadMore:n.handleInfiniteOnLoad,hasMore:!o&&a,useWindow:!1},x.a.createElement(c["a"],{dataSource:i,renderItem:function(e,t){return n.renderItem(e,t)}},o&&a&&x.a.createElement("div",{className:"demo-loading-container",style:{textAlign:"center"}},x.a.createElement(s["a"],null))))},n.onChangeBookBinding=function(e){if(null!=e){var t=n.state,o=t.currentEditBookId,a=t.storageBooks,i=Object.keys(a);i.forEach(function(t){parseInt(t,10)===o&&(a[t].book.price=parseFloat(e.price),a[t].book.binding_id=parseInt(e.value,10),a[t].book.defaultBindingName=e.name,n.resetStorageBooks(a))})}n.setState({enableChangeBinding:!1})},n.createOrder=function(){var e=n.state,t=e.storageBooks,o=e.totalPrice,a=n.props.dispatch,i=Object.keys(t),r=[];i.forEach(function(e){var n=t[e].book,o=n.count,a=n.price,i=n.checked,l=n.book_id,c=n.size_desc,s=n.thumbnail,d=n.printing_desc,u=n.defaultBindingName,g=n.binding_id,p=n.title,h=n.size_id,f=n.page_total_count,b=n.printing_id;if(!0===i){var k={book_id:l,book_cover_thumbnail:s,desc:u,binding_id:g,book_single_price:a,book_title:p,size_id:h,book_pages:f,amount:o,printing_id:b,size_desc:c,printing_desc:d};r.push(k)}}),0!==r.length?a({type:"cart/order",payload:{books:r,totalPrice:o,goodsType:1}}):l["a"].warn({message:"\u8bf7\u9009\u62e9\u4e66\u7c4d"})},n.state={loading:!0,hasMore:!0,storageBooks:null,totalPrice:0,selectItemCount:0,enableChangeBinding:!1,currentBookBindList:null,currentBookBindingId:null,currentEditBookId:null,bindingListTop:0,bindingListLeft:0},n}return S()(t,e),m()(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.dispatch,n=sessionStorage.getItem("cart");if(n){var o=JSON.parse(n),a=Object.keys(o);if(a.length>0){var i=[];a.forEach(function(e){i.push(parseInt(e,10)),o[e].book.checked=!0}),this.setState({storageBooks:o,selectItemCount:a.length}),t({type:"cart/attr",payload:{bookIds:i,callback:function(n){var i=n.bookAttrData,r=[];a.forEach(function(e){i.forEach(function(t){t.book_id===parseInt(e,10)&&(o[e].book.printing_id=t.printing_id,o[e].book.book_id=t.book_id,o[e].book.thumbnail=t.thumbnail,o[e].book.title=t.title,o[e].book.page_total_count=t.page_count,r.push({book_id:parseInt(e,10),printing_id:t.printing_id}))})}),e.setState({storageBooks:o}),t({type:"cart/attrAndPrice",payload:{bookBindings:r,callback:function(t){var n=t.bindAttrData;e.updateData({bindAttrData:n,bookAttrData:i})}}})}}})}}else l["a"].warn({message:"\u8d2d\u7269\u8f66\u6ca1\u6709\u4e66\u7c4d"})}},{key:"render",value:function(){var e=this,t=this.state,n=t.totalPrice,o=t.selectItemCount,a=t.enableChangeBinding,i=t.currentBookBindList,l=t.bindingListTop,c=t.bindingListLeft,s=t.currentBookBindingId;return x.a.createElement("div",{style:{position:"relative",marginTop:20,userSelect:"none"}},x.a.createElement("div",{style:{marginTop:50,color:"#333333",fontWeight:"bold",fontSize:14}},"\u6211\u7684\u8d2d\u7269\u8f66"),x.a.createElement(r["a"],{style:{height:2,backgroundColor:"#333333"}}),this.renderBookList(),x.a.createElement(r["a"],{style:{height:2,backgroundColor:"#333333"}}),x.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},x.a.createElement("div",{style:{color:"#000000",fontSize:14}},x.a.createElement(h["a"],{defaultChecked:!0,onChange:this.onCheckChangeAll,disabled:a}),x.a.createElement("span",{style:{marginLeft:20}},"\u5168\u9009"),x.a.createElement(r["a"],{type:"verticle",style:{height:14}}),x.a.createElement("span",{style:{marginLeft:10}},"\u5df2\u9009 ",o," \u4ef6")),x.a.createElement("div",null,x.a.createElement("span",{style:{fontSize:18,color:"#F3868B"}},"\u5408\u8ba1:  \xa5",n.toFixed(2)),x.a.createElement(u["a"],{type:"primary",style:{width:144,height:34,marginLeft:100,padding:"0 20px",fontSize:14},disabled:a,onClick:this.createOrder},"\u4e0b\u4e00\u6b65"))),!0===a?x.a.createElement("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0)"},onClick:function(){e.setState({enableChangeBinding:!1})}}):"",x.a.createElement(P,{visible:a,list:i,bindingId:s,top:l,left:c,onSure:function(t){e.onChangeBookBinding(t)},onCancel:function(){return e.setState({enableChangeBinding:!1})}}))}}]),t}(_["PureComponent"]),a=i))||a);t["default"]=D}}]);