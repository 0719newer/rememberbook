(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{fWZ6:function(e,t,n){"use strict";n.r(t);n("79+M");var a,o,i,r=n("L3aD"),l=(n("XNN1"),n("AsLl")),c=(n("6hcU"),n("xDfo")),s=(n("GnxM"),n("kzV1")),u=(n("4JfA"),n("y0Gf")),d=(n("5O5B"),n("oSpu")),h=(n("UV/7"),n("EKzH")),p=n("Pjwa"),f=n.n(p),b=n("2cji"),m=n.n(b),v=n("sp3j"),g=n.n(v),k=n("vZkh"),y=n.n(k),x=n("+KCP"),w=n.n(x),_=(n("Vu8O"),n("Uw+y")),E=(n("8GEp"),n("2x90")),S=(n("5Hxe"),n("lj4h")),C=n("uqIC"),T=n.n(C),I=n("LneV"),N=n("VrcO"),O=n.n(N),B=1,D=2,M=8,L=S["a"].TabPane,G=E["a"].confirm;_["a"].config({top:100,duration:1,maxCount:3});var A={NONE:"none"},j=(a=Object(I["connect"])(function(e){var t=e.shelf;return{shelf:t}}),a((i=function(e){function t(e){var n;return f()(this,t),n=g()(this,y()(t).call(this,e)),n.updateData=function(e,t,a){var o=t||n.defaultSelectTabIndex,i=n.props.shelf,r=i.bookGroup,l=e.tab,c=l[o],s=c.content_theme_type,u=c.type,d=c.actives;n.setState({loading:!0,hasMore:!0,actives:d});var h=(r&&r.length)>0&&r[o]?r[o].next_start:null;"end"!==h?n.loadBooks(s,u,o,h,a||n.perCount):n.setState({loading:!1,hasMore:!1})},n.loadBooks=function(e,t,a,o,i){var r=n.props.dispatch;r({type:"shelf/books",payload:{type:t,content_theme_type:e,selectIndex:a,next_start:o,count:i}})},n.handleInfiniteOnLoad=function(){var e=n.props.shelf,t=e.config;n.updateData(t,n.currentSelectTabIndex)},n.onTabChange=function(e){var t=parseInt(e,0);if(n.currentSelectTabIndex!==t){n.changeAction(A.NONE,null,null,null),n.currentSelectTabIndex=t;var a=n.props.shelf,o=a.config,i=a.bookGroup,r=o.tab,l=r[t],c=l.actives,s=l.name_key;n.setState({actives:c,name_key:s});var u=i[n.currentSelectTabIndex];if(null!=u){var d=u.books;if(null!=d&&u.books.length>0)return}n.updateData(o,n.currentSelectTabIndex)}},n.renderTab=function(){var e=n.props.shelf,t=e.config,a=e.bookGroup;if(null==t)return"";var o=t.tab;return T.a.createElement(S["a"],{defaultActiveKey:n.defaultSelectTabIndex.toString(),onChange:function(e){return n.onTabChange(e)}},o.map(function(e,t){return T.a.createElement(L,{tab:e.title,key:t.toString(),style:{marginTop:30,height:window.innerHeight-200,overflow:"hidden"}},T.a.createElement("div",{style:{width:"100%",height:"100%",overflow:"hidden"}},T.a.createElement("div",{style:{width:"100%",height:"100%",overflowY:"scroll",paddingRight:17,boxSizing:"content-box"}},n.renderList(a,t))))}))},n.renderList=function(e,t){var a=e&&e[t]&&e[t].books||[],o=n.state,i=o.loading,r=o.hasMore,l=o.column,c=a.concat([]);if(c.length>0&&(l+c.length)%l>0)for(var s=l-c.length%l,u=0;u<s;u+=1)c.push({});return T.a.createElement(O.a,{initialLoad:!1,pageStart:0,loadMore:n.handleInfiniteOnLoad,hasMore:!i&&r,useWindow:!1},T.a.createElement(d["a"],{grid:{column:l},dataSource:c,renderItem:function(e,t){return n.renderItem(e,t)}},i&&r&&T.a.createElement("div",{className:"demo-loading-container",style:{textAlign:"center"}},T.a.createElement(h["a"],null))))},n.onChangeCheckBox=function(e,t,a){var o=n.state.selectBookDic,i=e.target,r=i.checked,l=t.book_id,c=Object.assign({},o);r?c[l]={book:t,index:a}:!r&&c[l]&&delete c[l],n.setState({selectBookDic:c})},n.onRatioChangeHandler=function(e,t){var a=e.book_id,o={};o[a]={book:e,index:t},n.setState({selectBookDic:o})},n.onClickCoverImageHandler=function(e){var t=n.props.dispatch,a=n.state.action;a===A.NONE&&(e.content_theme_type===B||e.content_theme_type===D?window.open("https://www.shiqichuban.com/book/contents/".concat(e.book_id),"_self"):e.content_theme_type===M?t({payload:{book_id:e.book_id},type:"shelf/edit"}):1===e.type?window.open("https://www.shiqichuban.com/book/preview/".concat(e.book_id,"#page/1"),"_self"):window.open("https://www.shiqichuban.com/book/new_contents/".concat(e.book_id),"_self"))},n.renderCheckBox=function(e,t){var a=n.state,o=a.enableMultiSelect,i=a.rules,r=a.selectBookDic,l=null;return l=o?T.a.createElement(s["a"],{checked:null!=r[e.book_id],style:{position:"absolute",right:20,top:0},onChange:function(a){return n.onChangeCheckBox(a,e,t)}}):T.a.createElement(u["a"],{checked:null!=r[e.book_id],value:e.book_id,style:{position:"absolute",right:14,top:0},onChange:function(){return n.onRatioChangeHandler(e,t)}}),i&&i.forEach(function(t){var n=t.key,a=t.valueType,o=t.content_theme_type,i=t.enableForceSelect;!1===i&&(o?o.forEach(function(o){if(o===e.content_theme_type)if("boolean"===a)null!=e[n]&&!1!==Boolean(e[n])||(l=null);else if("number"===a){var i=t.range,r=i.min,c=i.max;(r&&e[n]<r||c&&e[n]>c)&&(l=null)}}):"boolean"===a&&(null!=e[n]&&!1!==Boolean(e[n])||(l=null)))}),l},n.renderWarningTip=function(e){var t=n.state.rules,a="";return t&&t.forEach(function(t){var n=t.key,o=t.content_theme_type;o&&o.forEach(function(o){if(e.content_theme_type===o){var i,r=t.range,s=t.warning,u=t.setOf,d=t.valueType;if(s&&r&&"number"===d){var h=r.min,p=r.max;h&&e[n]<h?i=s.min||"":p&&e[n]>p&&(i=s.max||"")}else if(s&&u&&"number"===d){var f=u.base;(e[n]+f)%f!==0&&(i=s.base)}i&&(a=T.a.createElement("div",null,T.a.createElement(l["a"],{placement:"topLeft",title:i},T.a.createElement(c["a"],{type:"warning",theme:"filled",style:{position:"absolute",width:20,bottom:10,left:30,color:"rgba(251, 54, 54, 0.65)",transform:"scale(1.2,1.2)"}}))))}})}),a},n.renderItem=function(e,t){var a=n.state,o=a.action,i=a.name_key,r=n.renderCheckBox(e,t),l=n.renderWarningTip(e,t);return T.a.createElement(d["a"].Item,{key:e.book_id||t.toString()},T.a.createElement("div",{style:{position:"relative"}},T.a.createElement("div",{style:{position:"relative",height:180}},T.a.createElement("div",{style:{position:"absolute",bottom:0,width:"70%",left:"15%"}},null==r&&o!==A.NONE?T.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",bottom:0,backgroundColor:"rgba(0, 0, 0, 0.3)"}}):"",null!=e.thumbnail?T.a.createElement("img",{alt:"\u5c01\u9762",src:"".concat(e.thumbnail),style:{width:"100%",boxShadow:"2px 2px 5px #ccc"},onClick:function(){return n.onClickCoverImageHandler(e)}}):""),o!==A.NONE&&null!=e.book_id&&r||"",o!==A.NONE&&null!=e.book_id&&l||""),T.a.createElement("div",{style:{position:"relative",marginTop:-10,height:100}},T.a.createElement("div",{style:{marginTop:10,marginLeft:"-3%",height:100,boxShadow:"0px -7px 7px -7px #ccc",backgroundColor:"white",width:"106%"}}),T.a.createElement("div",{style:{position:"absolute",width:"100%",top:20,textAlign:"center",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},e[i]||""))))},n.changeAction=function(e,t,a,o,i){var r=n.state,l=r.action,c=r.selectBookDic,s=i;if(e!==A.NONE&&e===l){var u=[];if(Object.keys(c).forEach(function(e){var t=c[e].book;a&&t&&a.forEach(function(e){var n=e.key,a=e.content_theme_type,o=e.valueType;a&&a.forEach(function(a){if(a===t.content_theme_type){var i=e.range,r=e.setOf;if(i&&"number"===o){var l=i.min,c=i.max;e.confirm&&(l&&t[n]<l?s=e.confirm.min:c&&t[n]>c&&(s=e.confirm.max))}else if(r&&"number"===o){var u=r.base;(t[n]+u)%u!==0&&(s=e.confirm.base)}}})}),u.push(e)}),0===u.length)return void _["a"].warn("\u8fd8\u6ca1\u6709\u9009\u4e66\uff01");s?G({content:s,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onOk:function(){n.submitChange(u,o,c),n.setState({action:e,enableMultiSelect:t,rules:a,selectBookDic:{}})},onCancel:function(){}}):(n.submitChange(u,o,c),n.setState({action:e,enableMultiSelect:t,rules:a,selectBookDic:{}}))}else n.setState({action:e,enableMultiSelect:t,rules:a,selectBookDic:{}})},n.submitChange=function(e,t,a){var o=n.props.dispatch;o({type:"shelf/".concat(t),payload:{book_ids:e,selectIndex:n.currentSelectTabIndex,selectBookDic:Object.assign({},a),callback:"delete"===t?n.deleteCallback:null}})},n.deleteCallback=function(e){var t=n.props.shelf,a=t.config,o=t.bookGroup;o&&null!=o[n.currentSelectTabIndex]&&e&&n.updateData(a,n.currentSelectTabIndex,e)},n.renderButtonGroup=function(){var e=n.props.shelf,t=e.config;if(null==t)return"";var a=t.actions,o=n.state,i=o.action,l=o.actives;return a.map(function(e,t){return l&&null!=l[e.type]&&!0===l[e.type]?T.a.createElement(r["a"],{key:t.toString(),type:"primary",size:"small",disabled:!(i===e.type||i===A.NONE),onClick:function(){return n.changeAction(e.type,e.multiSelect,e.rules,e.effects,e.confirm)},style:{marginLeft:10}},i===e.type?"\u786e\u5b9a":e.des):""})},n.currentSelectTabIndex=0,n.defaultSelectTabIndex=0,n.perCount=20,n.state={column:6,loading:!1,hasMore:!0,action:A.NONE,enableMultiSelect:!1,selectBookDic:{},rules:null,actives:null,name_key:"title"},n}return w()(t,e),m()(t,[{key:"componentDidMount",value:function(){var e=this.props.dispatch;e({type:"shelf/config",payload:{callback:this.updateData}})}},{key:"componentWillReceiveProps",value:function(e){this.setState({loading:!1,hasMore:!0});var t=e.shelf,n=t.config,a=t.bookGroup;if(a){var o=a[this.currentSelectTabIndex];if(o){var i=o.books,r=o.next_start,l=i.length;l<this.perCount&&"end"!==r&&this.updateData(n,this.currentSelectTabIndex,this.perCount-l)}}}},{key:"render",value:function(){var e=this,t=this.state.action;return T.a.createElement("div",{style:{position:"relative",marginTop:20}},this.renderTab(),T.a.createElement("div",{style:{position:"absolute",top:14,right:0}},t!==A.NONE?T.a.createElement(r["a"],{type:"primary",size:"small",onClick:function(){return e.changeAction(A.NONE,!1,null)},style:{marginLeft:10}},"\u53d6\u6d88"):"",this.renderButtonGroup()))}}]),t}(C["PureComponent"]),o=i))||o);t["default"]=j}}]);